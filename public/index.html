<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="styles/style.css">
</head>

<body>

    <!-- different values for accept https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#Unique_file_type_specifiers -->
    <!-- WHAT THE HECK IS ONCHANGE?!?!?!?! -->
    <!-- VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV -->
    <input type="file" id="fileInput" onchange="previewFile()" />
    <!-- <button id = "uploadBtn">Upload</button> -->

    <img src="" height="200" alt="">

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- <script src="javascripts/index.js"></script> -->
    <script>
        function previewFile() {
            const preview = document.querySelector('img');

            const file = document.querySelector('input[type=file]').files[0];

            const reader = new FileReader();

            // another load event example https://developer.mozilla.org/en-US/docs/Web/API/FileReader/load_event
            reader.addEventListener("load", function () {
                console.log("load function");
                // Updates the img tag with the base64 string that was created
                preview.src = reader.result;

                let imgString = reader.result;


                axios.post('/api/Images', {
                    image_string: imgString,
                }
                ).then(function (response) {
                    console.log(response);
                    console.log("image string posted")
                })
                    .catch(function (error) {
                        console.log(error);
                    });


            }, false);

            console.log(file);

            if (file) {
                console.log("trigger");
                // console.log(file);
                // This triggers the load in the event listener for the reader. 
                // This is older code that existed before promises. This handles the async nature of reader.
                // This allows reader to complete reading the file into a url (base64) before the code updates the img with base64 string.
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>

</html>